<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App - Part 4</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">Todo App</a>
            <div class="navbar-nav flex-row gap-3" id="nav-links">
                <a class="nav-link" href="/login">Login</a>
                <a class="nav-link" href="/register">Register</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">Part 4: User Login</h4>
                    </div>
                    <div class="card-body">
                        <h5>What's new in this part?</h5>
                        <ul>
                            <li><strong>Password Hashing</strong> - Passwords are now stored securely</li>
                            <li><strong>JWT Tokens</strong> - Used to stay logged in</li>
                            <li><strong>Login Page</strong> - Verify email and password</li>
                            <li><strong>Dashboard</strong> - Only visible when logged in</li>
                        </ul>

                        <hr>

                        <h5>How JWT works:</h5>
                        <pre class="bg-dark text-light p-3 rounded">
1. User logs in with email/password
2. Server creates JWT token containing user info
3. Token sent to browser, stored in localStorage
4. Browser sends token with every request
5. Server verifies token to identify user</pre>

                        <hr>

                        <div id="logged-out-buttons">
                            <a href="/register" class="btn btn-success btn-lg me-2">Register</a>
                            <a href="/login" class="btn btn-primary btn-lg">Login</a>
                        </div>

                        <div id="logged-in-buttons" class="d-none">
                            <div class="alert alert-success" id="welcome-message"></div>
                            <a href="/dashboard" class="btn btn-success btn-lg me-2">Go to Dashboard</a>
                            <button onclick="logout()" class="btn btn-outline-danger btn-lg">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || 'null');

        if (token && user) {
            document.getElementById('logged-out-buttons').classList.add('d-none');
            document.getElementById('logged-in-buttons').classList.remove('d-none');
            document.getElementById('welcome-message').textContent = `Welcome back, ${user.username}!`;
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            location.reload();
        }
    </script>
</body>
</html>
